<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Nova Atribuição - LevelUp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/admin-layout.css}">
    <link rel="stylesheet" th:href="@{/css/assignment-form.css}"> </head>
<body>

<div class="wrapper">
    <nav th:replace="~{fragments/sidebar :: sidebar}"></nav>

    <div id="content" class="d-flex flex-column justify-content-center align-items-center min-vh-100">
        <div class="container animate__animated animate__fadeInUp" style="max-width: 700px;">

            <div class="assignment-card">
                <div class="assignment-card-header">
                    <h4><i class="fa-solid fa-paper-plane me-2"></i> Nova Atribuição de Missão</h4>
                </div>
                <div class="assignment-card-body">
                    <form th:action="@{/admin/assignments/save}" th:object="${assignmentDto}" method="post">

                        <div class="mb-4">
                            <label class="form-label">Selecione a Tarefa</label>
                            <select class="form-select form-control-dark" th:field="*{taskId}" required>
                                <option value="">-- Escolha uma tarefa --</option>
                                <option th:each="task : ${tasks}"
                                        th:value="${task.id}"
                                        th:text="${task.title} + ' (' + ${task.pointsValue} + ' XP)'"></option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Atribuir Para:</label>
                            <div class="assign-type-toggle">
                                <input type="radio" class="btn-check" name="assignType" id="typeUser" autocomplete="off" checked onclick="toggleAssignType('user')">
                                <label class="btn btn-custom-toggle" for="typeUser"><i class="fa-solid fa-user me-2"></i> Usuário Específico</label>

                                <input type="radio" class="btn-check" name="assignType" id="typeTeam" autocomplete="off" onclick="toggleAssignType('team')">
                                <label class="btn btn-custom-toggle" for="typeTeam"><i class="fa-solid fa-users me-2"></i> Equipe Inteira</label>
                            </div>
                        </div>

                        <div class="mb-4" id="userSelectGroup">
                            <select class="form-select form-control-dark" id="userId" th:field="*{userId}">
                                <option value="">-- Selecione o Colaborador --</option>
                                <option th:each="user : ${users}" th:value="${user.id}" th:text="${user.fullName}"></option>
                            </select>
                            <small class="text-danger" th:if="${#fields.hasErrors('userId')}" th:errors="*{userId}"></small>
                        </div>

                        <div class="mb-4 d-none" id="teamSelectGroup">
                            <select class="form-select form-control-dark" id="teamId" th:field="*{teamId}">
                                <option value="">-- Selecione a Equipe --</option>
                                <option th:each="team : ${teams}" th:value="${team.id}" th:text="${team.teamName}"></option>
                            </select>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label">Data de Início</label>
                                <input type="date" class="form-control form-control-dark" th:field="*{periodStart}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Prazo Final</label>
                                <input type="date" class="form-control form-control-dark" th:field="*{periodEnd}" required>
                            </div>
                        </div>

                        <div class="mb-4 form-check form-switch d-flex align-items-center gap-2">
                            <input class="form-check-input" type="checkbox" id="isMandatory" th:field="*{isMandatory}">
                            <label class="form-check-label text-white mb-0" for="isMandatory">Missão Obrigatória</label>
                        </div>

                        <div class="d-flex justify-content-center gap-3 mt-5">
                            <a href="/admin/assignments" class="btn btn-tech-outline">Cancelar</a>
                            <button type="submit" class="btn btn-tech-primary px-5">Confirmar Atribuição</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    function toggleAssignType(type) {
        const userGroup = document.getElementById('userSelectGroup');
        const teamGroup = document.getElementById('teamSelectGroup');
        const userSelect = document.getElementById('userId');
        const teamSelect = document.getElementById('teamId');

        if (type === 'user') {
            userGroup.classList.remove('d-none');
            teamGroup.classList.add('d-none');
            teamSelect.value = ''; // Limpa seleção do time
        } else {
            userGroup.classList.add('d-none');
            teamGroup.classList.remove('d-none');
            userSelect.value = ''; // Limpa seleção do usuário
        }
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>